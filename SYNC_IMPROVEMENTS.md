# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã–º–∏ –∑–∞–º–µ—Ç–∫–∞–º–∏

## üéØ –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ë—ã–ª–æ:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏ –Ω–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –∑–∞–º–µ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞—Å—å —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —Ç–∞–∫ –∫–∞–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å.

**–†–µ—à–µ–Ω–∏–µ: Tombstones (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)**

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏:
1. –ó–∞–º–µ—Ç–∫–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `deleted=True` –≤–º–µ—Å—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
2. –ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ tombstone –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3. –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–∏–¥—è—Ç, —á—Ç–æ –∑–∞–º–µ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∞
4. –ß–µ—Ä–µ–∑ 30 –¥–Ω–µ–π tombstone —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

```
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 1:          –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 2:
[–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏]  ‚Üí  
‚Üì –ü–æ–º–µ—á–µ–Ω–æ deleted    
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è       ‚Üí  [–ü–æ–ª—É—á–µ–Ω tombstone]
                       ‚Üì –ó–∞–º–µ—Ç–∫–∞ —Å–∫—Ä—ã—Ç–∞
```

### 2. ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: OneDrive —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –∫–æ–ø–∏–∏ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**–ë—ã–ª–æ:** OneDrive —Å–æ–∑–¥–∞–≤–∞–ª —Ñ–∞–π–ª—ã —Ç–∏–ø–∞ `notes-DESKTOP-ABC123.json` –∏–ª–∏ `notes (conflicted copy).json`, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –≤—Ä—É—á–Ω—É—é –æ–±—ä–µ–¥–∏–Ω—è—Ç—å.

**–†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤**

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ
2. –ó–∞–º–µ—Ç–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–ª–∏–≤–∞—é—Ç—Å—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ–∞–π–ª–æ–º –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É Last-Writer-Wins
3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
–ü–∞–ø–∫–∞ OneDrive:
‚îú‚îÄ‚îÄ notes.json                      ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ notes-DESKTOP-ABC123.json       ‚Üê –ö–æ–Ω—Ñ–ª–∏–∫—Ç 1
‚îî‚îÄ‚îÄ notes (conflicted copy).json    ‚Üê –ö–æ–Ω—Ñ–ª–∏–∫—Ç 2

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
‚îú‚îÄ‚îÄ notes.json                      ‚Üê –í—Å–µ –∑–∞–º–µ—Ç–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã
```

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Tombstones (–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–º–µ—Ç–∫–∏:**
```json
{
  "id": "abc123",
  "title": "–ó–∞–º–µ—Ç–∫–∞",
  "body": "–¢–µ–∫—Å—Ç",
  "last_modified": "2025-11-16T12:00:00Z",
  "version": 2,
  "deleted": true  ‚Üê –ù–æ–≤–æ–µ –ø–æ–ª–µ
}
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª:**
1. **–°–æ–∑–¥–∞–Ω–∏–µ:** `deleted=false` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
2. **–£–¥–∞–ª–µ–Ω–∏–µ:** `deleted=true`, –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** Tombstone –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
4. **–û—á–∏—Å—Ç–∫–∞:** –ß–µ—Ä–µ–∑ 30 –¥–Ω–µ–π tombstone —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö)
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ OneDrive

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º:
   - `notes-*.json` (–∫—Ä–æ–º–µ `notes.json`)
   - –§–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ `conflicted` –≤ –∏–º–µ–Ω–∏

2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–º–µ—Ç–∫–∏ –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ–º —Ñ–∞–π–ª–µ:
   - –ï—Å–ª–∏ –∑–∞–º–µ—Ç–∫–∏ –Ω–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ñ–∞–π–ª–µ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å
   - –ï—Å–ª–∏ –∑–∞–º–µ—Ç–∫–∞ –µ—Å—Ç—å ‚Üí —Å—Ä–∞–≤–Ω–∏—Ç—å `last_modified`, –≤–∑—è—Ç—å –±–æ–ª–µ–µ —Å–≤–µ–∂—É—é

3. –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–π —Ñ–∞–π–ª

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ß–∏—Å—Ç–∞—è –æ–±–ª–∞—á–Ω–∞—è –ø–∞–ø–∫–∞ –±–µ–∑ –º—É—Å–æ—Ä–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:

```bash
python test_tombstones.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è (Tombstones)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ OneDrive
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö Tombstones

## üõ†Ô∏è –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### API –∏–∑–º–µ–Ω–µ–Ω–∏—è

**notes.py:**
```python
# –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
store.delete_note(note_id)  # –¢–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç deleted=True

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–º–µ—Ç–æ–∫ (–±–µ–∑ tombstones)
active_notes = store.get_all_notes()

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∫–ª—é—á–∞—è tombstones (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
all_notes = store.get_all_notes_including_deleted()

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö tombstones
cleaned = store.cleanup_tombstones(older_than_days=30)
```

**sync.py:**
```python
# –ü–æ–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
conflict_files = sync_manager.find_conflict_files()

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ load_remote_notes()
remote_notes = sync_manager.load_remote_notes()
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–æ–≤—ã–µ –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏—è:
```
INFO - –ó–∞–º–µ—Ç–∫–∞ –ø–æ–º–µ—á–µ–Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π (tombstone): abc123
INFO - –û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–π —Ñ–∞–π–ª: notes-DESKTOP-ABC123.json
INFO - –ó–∞–º–µ—Ç–∫–∞ xyz789 –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
INFO - –ö–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–π —Ñ–∞–π–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ —É–¥–∞–ª—ë–Ω
INFO - Tombstone —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—ë–Ω: abc123 (–≤–æ–∑—Ä–∞—Å—Ç: 35 –¥–Ω–µ–π)
INFO - –°–ª–∏—è–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: 10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫, 2 tombstones, 0 –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
```

## üìã –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –±–µ–∑ –ø–æ–ª—è `deleted`:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `deleted=false`
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

**–°–º–µ—à–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
- –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è ‚Üí –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: tombstones –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π, –∑–∞–º–µ—Ç–∫–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è
- –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Üí –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è: –∑–∞–º–µ—Ç–∫–∏ —Å `deleted=true` –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –≤ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ Tombstones —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ OneDrive
3. ‚è≥ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ —Ç–∞–π–º–µ—Ä—É (v0.4.0)
4. ‚è≥ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∞–π–º–µ—Ä—É (v0.4.0)
5. ‚è≥ –ü–æ–∏—Å–∫ –ø–æ –∑–∞–º–µ—Ç–∫–∞–º (v0.4.0)

---

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 16 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 0.3.0  
**–ö–æ–º–º–∏—Ç:** 3717775 + bdbdcf7
